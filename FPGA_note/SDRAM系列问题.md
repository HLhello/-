## 一、 基本概念​	

很多人分不清楚SDRAM与SRAM的，这里从百度上找的资料先对比一下

1. SDRAM——同步动态随机存储器——synchronous dynamic random access memory
   - 同步是指其时钟频率与对应控制器（CPU/FPGA）的系统时钟频率相同，并且内部命令的发送与数据传输都是以该时钟为基准；
   - 动态是指存储阵列需要不断的刷新来保证数据不丢失；
   - 随机指数据的读取和写入是指可以随机指定地址，而不是必须按照严格的线性次序变化。 
2. SRAM——异步静态随机存储器——Asynchronous Static RAM
   - 常应用于 FPGA 和 DSP 系统中，包括现在的 MCU 系统
   - 该存储器不存在的动态刷新特征。
   -  SRAM 的 S 也不是代表同步的意思。是静态的意思
   - 相反， SRAM 属于异步器件，在工作时是不需要外部提供时钟的
3. 在存储数据的物理结构方面
   - SDRAM 使用电容的电荷存储特性存储数据，而 SRAM使用 CMOS 晶体管存储数据，因此，从这个结构方面也就决定了 SDRAM 的运行功耗要远远低于 SRAM。
   - 同时，由于使用晶体管存储数据，要能够正确的存储一位数据，需要最少 6个晶体管。因此，从芯片面积上来说，单片 SRAM 芯片的容量不可能做到很高。目前常见的有 512K 字节和 1024K 字节容量的，而 SDRAM 则可以最多做到 64M 字节（512Mbit）。所以，在需要大量存储数据的场合， SDRAM 就成为了首选。 
   - 工作频率运行速度SRAM（外部能跑100M）比SDRAM（能跑到133M）低，SRAM（512k十几块钱）比SDRAM（32m的几块钱）的价格高
   - SRAM较快的速度，较高的成本，更低的存储数据的能力，低功耗，低延迟
   - DRAM带宽低，成本低，更高的数据存储的能力，高功耗，延迟较高

## 二、SDRAM的存取原理

1. 打开行地址线与列地址线，存储在电容中的数据就会输出

   ![存储原理图]()

   1. 打开行列地址是需要时间的，这个时间间隔就叫做 t_RCD（active-to-read or write delay）
      - 对于某个型号的sdram器件，其最大运行频率为133M的器件（一个时钟周期为7.52ns），该值为15ns，也就是说需要两个时钟周期才能打开行列地址，而对于t_RCD为20ns的器件，就需要三个时钟周期
   2. 行列地址打开，数据并不是立即出现在总线上，这个延迟就叫列选通潜伏期（CL，CAS READ latency）
      - cl是指从读命令被寄存到数据总线上的第一个有效数据的时钟间隔，这个潜伏期可以被设置成两个时钟或者三个时钟
   3. 类似于矩阵开关吧我感觉
   4. 刷新放大器的作用
      1. 只要是电容就有自行放电的特性，电容的电压并不能一直保持
      2. 所以就有一个刷新放大器， 刷新放大器根据数据重新给电容充电跟新

SDRAM的引脚

![]()

SDRAM特性

1. 通常情况下，SDRAM是拥有四个BANK的动态刷新存储器，存储器工作在3.3V的电压下，DDR SDRAM工作电压是2.5V，DDR2 SDRAM的工作电压是1.8V，工作电压越低，信号速率越快
2. 对于256Mbit的SDRAM，每个BANK存储64Mbit，8192行 * 2048列 * 4bit，或者8192行 * 1024列 * 8bit 或者8192行 * 512列 * 16bit，行列地址位宽与输出位宽的关系
3.  对于128Mbit的sdram，4个bank，每个32Mbits，4096*512个存储单元，每个存储单元16Mbit，也就是数据位宽为16Mbit
4. 对于sdram的读写是以突发的方式进行的，对sdram的读写是从一个指定的位置开始的，并按照指定的长度读出或写入长度，以编程好的数据进行顺序读写数据
   1. 激活命令，（A0--A12上是行地址，ba0，ba1是bank地址）
      - 激活命令是用来为后续的操作打开一个特定的bank和行，该行会一直保持激活状态，并可以进行读写，只有执行一个预充电命令，该行才会关闭，同一个bank中一次只能激活一行，在某行已经激活的状态下，必须先进行预充电，才能激活该bank中的另一行，
   2. 读写命令，（A0-A8上是列地址）
      - 该命令用来启动对一个已经激活行的突发读取操作
      - ba0 ba1 指定需要读取的bank
      - A0到A9为行地址
      - A10表示突发读取完成后，立即进行预充电，即关闭该行，高电平有效
5. 对于sdram的操作，是通过对应的命令来实现的，是由芯片控制引脚组合成不同的状态以表示
   1. 命令禁止，禁止直行新的命令，已执行的命令不受影响
   2. 空命令，给sdram传递一个无需操作的信息，防止sdram处于空闲或者等待状态时，其他命令被写入，此命令对正在执行的操作没有影响
   3. 加载模式寄存器，通过地址线写入sdram，该命令只有在所有bank都处于空闲状态才能进行，必须等待对应的响应周期（tMED）才能执行新的命令
      1. 模式寄存器总共有13位，12位和11位以及10位保留
      2. burst length（A0,A1,A2），
         - 突发类型，burst type 分为两种类型，顺序（sequential）和隔行（interleaved），按照burst length将行每一行截成几段，每一段截成环，比如burst length是3，将每行16bit数据分成四个环，读出顺序按照设置的突发类型来输出
      3. 写突发模式—第九位
   4. 控制信号组成 = {cs_n,ras_n,cas_n,we} = 4‘b0100 写入命令，写入命令不存在潜伏期，直接写入，写突发可以被写突发打断
   5. 预充电/关闭行
      - 可以将所有bank中相同的行全部关闭掉，预充电命令执行后，需要经过t_RP时间后，才能对bank重新操作
   6. 自动预充电
      - 不增加额外执行命令的前提下，达到使用预充电指令一样的效果，也就是A10
   7. 突发中断
      - 突发命令并不会对对应行进行预充电，也就是执行了突发中断操作后，该行仍然处于被激活状态
   8. 自动刷新
      - 执行自动刷新命令之前，所有bank都必须关闭，对于商业或工业是哪个的器件，256m的sdram在每64毫秒内需要执行8192次自动率性操作，对于汽车行业，每16毫秒执行8192次操作 
      - 可以将时间间隔设置成均匀分布在64ms内，也可以几种一段时间尽心刷新
6. 要刷新就要打开行地址线，预充电，也是要保持数据

## 三、SDRAM 操作时序

1. SDRAM上电初始化
   - 在sdram进行正常的操作之前，sdram必须被初始化，
   - sdram首先需要延时等待100us，在这个等待期间，sdram只能赋给禁止命令或者空命令
   - 100us之后需要进行预充电命令，所有bank都必须被预充电，以使器件进入空闲状态
   - 进入空闲状态，至少需要执行两个周期的自动刷新命令，
   - 自动刷新命令之后可以对sdram进行加载模式寄存器了（原因：模式寄存器上电后是未知状态的）
   - 加载模式寄存器后，需要的话，可以执行两次自动刷新命令
2. 初始化步骤
   1. 加载电源（VDD和VDDQ）
   2. CKE设置为低（LVTTL逻辑电平）
   3. 加载稳定的时钟信号
   4.  等待至少100us此时的命令保持为INHIBIT或者NOP
   5. 在步骤4的100us中的某个时刻，将CKE设置为高，命令仍然保持为INHIBIT或者NOP
   6. 在步骤4的100us结束后，即刻发出一个全部bank预充电命令（precharge all）
   7. 等待至少tRP（行预充电最小周期），此时命令仅允许是DESELECT或者NOP
   8. 发出一个自动刷新命令（AUTO REFFRESH）
   9. 等待至少tRFC（自动预充电周期），此时的命令仅允许是INHIBIT或者NOP
   10. 再发出一个自动刷新命令（AUTO REFFRESH）
   11. 再等待至少tRFC（自动预充电周期），此时的命令仅允许是INHIBIT或者NOP
   12. 使用LMR命令设置模式寄存器，寄存器模式的值由A0-A11传输
   13. 等待至少tMRD（LMR命令至激活或刷新命令的最小间隔），此时的命令仅允许是DESELECT或者NOP
3. 自动刷新与自刷新的区别
   1. 自刷新是内部产生时钟刷新，不适用外部时钟信号
   2. 自动刷新对每一行的刷新是自动切换的，在64ms内自动刷新，进入自动刷新之前使用precharge关闭所有bank的行
4. 自刷新时序
   - 用的比较少
5. 自动刷新时序
   - 保证关闭所有bank的行也不一定需要预充电
   - 64ms内完成8192次刷新，可以64ms等分的进行刷新，即每7.5us内进行一次刷新，也可以集中刷新
6. 不带自动预充电单一位置的读操作时序
   - 激活某一行，地址线上输入行地址，ba上给出bank地址，延迟tRCD（active to read or write）
   - 接着进行read命令，地址线上输入列地址，等待CL（模式寄存器中设置CL），BL = 1
   - 进行预充电的命令等待tRP
   - 然后可以进行下一次的读写
7. 带自动预充电的单一位置读操作时序
   - 激活，经过二/三个周期的nop命令 
   - read
8. 跨bank随机读操作
9. 页读取操作
10. 带屏蔽的读操作
11. 自动预充电的写操作
12. ….还有很多操作可以从官网的手册上查询

## tips

1. 关于命令在什么时候被读取
   - 通过pll产生两个相同频率的时钟，这两路时钟信号之间的相位差为-90/-180（时钟延迟不同）度，第一路时钟产生command命令，第二个命令输出送入sdram芯片中，作为芯片的控制时钟
2. 预充电命令
   - 发出read命令后的BL个时钟周期后sdram内部自动产生预充电命令
3. 类似sdram的芯片仿真程序是从芯片生产公司网站直接下载仿真模型