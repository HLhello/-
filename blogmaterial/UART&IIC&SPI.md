# UART & IIC & SPI

背景

- 现今，在低端数字通信应用领域，我们随处可见IIC (Inter-Integrated Circuit) 和 SPI (Serial Peripheral Interface)的身影。原因是这两种通信协议非常适合近距离低速芯片间通信。Philips（for IIC）和Motorola（for SPI） 出于不同背景和市场需求制定了这两种标准通信协议。

- IIC 开发于1982年，当时是为了给电视机内的CPU和外围芯片提供更简易的互联方式。电视机是最早的嵌入式系统之一，而最初的嵌入系统是使用内存映射（memory-mapped I/O）的方式来互联微控制器和外围设备的。要实现内存映射，设备必须并联入微控制器的数据线和地址线，这种方式在连接多个外设时需大量线路和额外地址解码芯片，很不方便并且成本高。为了节省微控制器的引脚和和额外的逻辑芯片，使印刷电路板更简单，成本更低，位于荷兰的Philips实验室开发了 ‘Inter-Integrated Circuit’，IIC 或 IIC ，一种只使用二根线接连所有外围芯片的总线协议。最初的标准定义总线速度为100kbps。经历几次修订，主要是1995年的400kbps，1998的3.4Mbps。

- SPI总线首次推出是在1979年，Motorola公司将SPI总线集成在他们第一支改自68000微处理器的微控制器芯片上。SPI总线是微控制器四线的外部总线（相对于内部总线）。与IIC不同，SPI没有明文标准，只是一种事实标准，对通信操作的实现只作一般的抽象描述，芯片厂商与驱动开发者通过data sheets和application notes沟通实现上的细节。对于有经验的数字电子工程师来说，用SPI互联两支数字设备是相当直观的。SPI是种四根信号线协议以及SPI有四种操作模式

作者：斜杠

链接：https://zhuanlan.zhihu.com/p/35250455

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

我们来看看比特速递公司(bit-delivering company,PDC)是如何输送8bit货物的。

现在有一辆拉载着8bit数据的快递货车由公司(PC端/嵌入式端/外设设备)发出。携带着齐全证件(起始位、奇偶位、停止位)，愉快地上路了。

仪表盘上显示着稳定地9600bps，表示一秒可送9600bit(包括证件在内)，经过“长途跋涉”，终于到达终点站(另一个PC/嵌入式/外设设备)。

首先，货车司机出示货运单(起始位)表示“您要的货到了”，这时，终点站验货员要对其进行验货。可悲的是，验货员是个瞎子，他可不能一个一个地数。幸好，早在发货之前双方已经约定，使用中华传统技艺——接头暗号(奇偶位)——进行验货。他们的规则是：发货公司表示，今天的暗号是天王盖地虎(奇校检)，那么货运单上写的就是宝塔镇河妖(哎对上了);而公司要是说，今天的暗号是今朝有酒今朝醉(偶校检)，货运单上还是宝塔镇河妖，那就对不上。因为tomorrow is an other day才是正解。

瞎子验货员一看货运单，哎一拍即合，验货员笑纳了8bit的数据。可别急，还得检查是否漏货，万一少了一两个bit，那就乱码了。一看货运单上的标示(停止位)，瞎子哥终于放心地签收了，然后摆摆手，这时货车靠边(空闲位)腾出空位。瞎子哥等待下一辆货车。

发现没
​       第一：所有证件(起始位，停止位，奇偶位)都由比特速递公司(即发送端)提供。
​       第二：货物(8bit数据)只能一车一车有序接收或者从公司发送。
第三：空闲位需要瞎子验货员摆手示意。也就是说，空闲位不属于速递公司的必备证件，终点站在收货后，自己腾出空位来，等待下一辆货车。


实际上，在硬件逻辑电路中实现发送端给的货车装货、配备证件和运货单需要严格按照图1的格式，数据流(包括起始位、停止位和校检位)必须按照按照波特率规定的速度一bit一bit地输送出去。而接受端，需要严格按照波特率规定的速度，在每一个bit的中间位置处采集送来的信号(为了数据的顺利采集，有时将每一个bit分成数份，再在每小份的中间位置采集)。

具体实现需要在工程中上手实践哦~
欢迎指正。





作者：胡建东

链接：https://zhuanlan.zhihu.com/p/35991046

来源：知乎

著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。

UART的概念

通用异步收发传输器，通常称作UART，是一种异步收发传输器。是异步通信协议。特性：两根线，全双工，异步通信，速度较慢。也就是一根发送数据，一根接收数据，并且**电平逻辑是时间的函数。**发送和接收一个bit都有固定的宽度，也就是只有等于这个时间宽度时才认为是1bit。为了约定时间宽度，就诞生了**比特率**的概念：**表示1s信号可以传输N bit的数据**，单位bps=bit per second。比如，9600bps = 1s发送或接收9600 bit数据，那么1bit数据时间宽度也就是1/9600 s。 



​    常见比特率——9600bps 19200bps 38400bps 57600bps 115200bps



什么是RS232

RS232是物理层的电气接口要求。是一种接口标准。uart可以使用rs232物理层来通信。总的来说，对于一项通信任务，通信协议可以使用UART协议，而UART协议可以通过COM端口来实现硬件连线，此协议下的传输方式可以选用RS232或者RS485等。



UART协议格式

信号线上空闲的时候为高电平，当出现下跳到低电平的时候表示数据的起始位，接着是先发送低位（LSB）后发送高位（MSB）的数据流，尾部可加奇偶校验位，最后加停止位，停止位长度可以定义。本例实现无奇偶校验位，1bit停止位，波特率9600~115200可改变。



![img](https://pic2.zhimg.com/v2-e346b48a1e446d1f17c87daf844d4959_b.jpg)



多帧发送结构如下：



![img](https://pic2.zhimg.com/v2-df58049d703fc5171014412118dc6241_b.jpg)



代码实现解释